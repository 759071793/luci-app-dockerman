<div class="cbi-section">
	<h3><%:Stats%></h3>

	<div class="table" id="table_stats" width="100%">
		<div class="tr cbi-rowstyle-2"><div class="td left" width="33%"><%:CPU Useage%></div><div class="td left" id="cpu">-</div></div>
		<div class="tr cbi-rowstyle-1"><div class="td left" width="33%"><%:Memory Useage%></div><div class="td left" id="memory">-</div></div>
		<!-- <div class="tr"><div class="td left" width="33%"><%:Network TX/RX%></div><div class="td left" id="network">-</div></div> -->
	</div>


</div>


<script type="text/javascript">//<![CDATA[
	function progressbar(v, m, pc, np)
	{
		m = m || 100
		// var vn = parseInt(v) || 0;
		// var mn = parseInt(m) || 100;
		// var pc = Math.floor((100 / mn) * vn);

		return String.format(
			'<div style="width:100%%; max-width:500px; position:relative; border:1px solid #999999">' +
				'<div style="background-color:#CCCCCC; width:%d%%; height:15px">' +
					'<div style="position:absolute; left:0; top:0; text-align:center; width:100%%; color:#000000">' +
						'<small>%s / %s '+ (np == true ? "" :'(%d%%)')+'</small>' +
					'</div>' +
				'</div>' +
			'</div>', pc, v, m, pc
		);
	}

	function niceBytes(bytes,decimals) {
   if(bytes == 0) return '0 Bytes';
   var k = 1000,
       dm = decimals + 1 || 3,
       sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],
       i = Math.floor(Math.log(bytes) / Math.log(k));
   return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
  }

	XHR.poll(5, '/cgi-bin/luci/admin/docker/container_stats/<%=self.container_id%>', { status: 1 },
	function(x, info){
		var e;

		if (e = document.getElementById('cpu'))
			e.innerHTML = progressbar(
				(info.cpu_percent), 100, (info.cpu_percent?info.cpu_percent:0));

		if (e = document.getElementById('memory'))
			e.innerHTML = progressbar(
				niceBytes(info.memory.mem_useage),
				niceBytes(info.memory.mem_limit),
				((100 / (info.memory.mem_limit?info.memory.mem_limit:100)) * (info.memory.mem_useage?info.memory.mem_useage:0))
			);
		let num = 1
		for (var key in info.bw_rxtx){
			if (! document.getElementById(key)){
				let tab = document.getElementById("table_stats")
				num ++
				let div='<div class="tr cbi-rowstyle-'+ (num%2===0 ? "2":"1") +'"><div class="td left" width="33%"><%:Network TX/RX%></div><div class="td left" id="'
								+ key +
								'">-</div></div>'
				tab.insertAdjacentHTML('beforeend',div)
			}
			e=document.getElementById(key)
			e.innerHTML = progressbar(
				niceBytes(info.bw_rxtx[key].bw_tx),
				niceBytes(info.bw_rxtx[key].bw_rx),
				((100 / (info.bw_rxtx[key].bw_rx?info.bw_rxtx[key].bw_rx:100)) * (info.bw_rxtx[key].bw_tx?info.bw_rxtx[key].bw_tx:0))>100 ? 100 :Math.floor((100 / (info.bw_rxtx[key].bw_rx?info.bw_rxtx[key].bw_rx:100)) * (info.bw_rxtx[key].bw_tx?info.bw_rxtx[key].bw_tx:0)) ,
				true
				);
	}
	});
//]]></script>